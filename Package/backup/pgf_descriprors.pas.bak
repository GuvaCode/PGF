unit pgf_descriprors;

{$mode objfpc}{$H+}

interface

uses
  Classes, SysUtils, LazIDEIntf, ProjectIntf, Controls, Forms;

type
    { TPGFApplicationDescriptor }
    TPGFApplicationDescriptor = class(TProjectDescriptor)
  public
    constructor Create; override;
    function GetLocalizedName: string; override;
    function GetLocalizedDescription: string; override;
    function InitProject(AProject: TLazProject): TModalResult; override;
    function CreateStartFiles({%H-}AProject: TLazProject): TModalResult; override;
  end;

    { TPGFFileUnit }

    TPGFFileUnit = class(TFileDescPascalUnit)
  public
    constructor Create; override;
    function GetInterfaceUsesSection: string; override;
    function GetLocalizedName: string; override;
    function GetLocalizedDescription: string; override;
    function GetUnitDirectives: string; override;
    function GetImplementationSource(const Filename, SourceName, ResourceName: string): string; override;
    function GetInterfaceSource(const {%H-}aFilename, {%H-}aSourceName,{%H-}aResourceName: string): string; override;

    end;
   const LE = #10;

   procedure Register;

implementation

procedure Register;
begin
  RegisterProjectFileDescriptor(TPGFFileUnit.Create,FileDescGroupName);
  RegisterProjectDescriptor(TPGFApplicationDescriptor.Create);
end;

function FileDescriptorByName() : TProjectFileDescriptor;
begin
  Result:=ProjectFileDescriptors.FindByName('PGF Unit');
end;

{ TPGFFileUnit }

constructor TPGFFileUnit.Create;
begin
  inherited Create;
  Name:='PGF Unit';
  UseCreateFormStatements:=False;
end;

function TPGFFileUnit.GetInterfaceUsesSection: string;
begin
  Result:= LineEnding+
  ' SysUtils,'                                         +LineEnding+
  ' phxTypes,'                                         +LineEnding+
  ' phxClasses,'                                       +LineEnding+
  ' phxMath,'                                          +LineEnding+
  ' phxDevice,'                                        +LineEnding+
  ' phxApplication,'                                   +LineEnding+
  ' phxGraphics,'                                      +LineEnding+
  ' phxCanvas,'                                        +LineEnding+
  ' phxTexture'                                        +LineEnding;
end;

function TPGFFileUnit.GetLocalizedName: string;
begin
  Result:='Delphi Form bla bla bla';
end;

function TPGFFileUnit.GetLocalizedDescription: string;
begin
  Result:='Create a new blank Unit bla bla';
end;

function TPGFFileUnit.GetUnitDirectives: string;
begin
   result := '{$mode delphi}{$H+}'
end;

function TPGFFileUnit.GetImplementationSource(const Filename, SourceName,
  ResourceName: string): string;
begin
{$I mincode.inc}
end;

function TPGFFileUnit.GetInterfaceSource(const aFilename, aSourceName,
  aResourceName: string): string;
var Source:String;
begin
 // Result:=inherited GetInterfaceSource(aFilename, aSourceName, aResourceName);
Source:='type'                                      +LineEnding+LineEnding+
 'TGame = class(TPHXApplication)'                   +LineEnding+
 '  private'                                        +LineEnding+
 '    Device : TPHXDevice;'                       +LineEnding+
 '    Canvas : TPHXCanvas;'                       +LineEnding+
 '    Texture: TPHXTexture;'                      +LineEnding+
 '  public'                                         +LineEnding+
 '    procedure Init; override;'                    +LineEnding+
 '    procedure Update; override;'                  +LineEnding+
 '    procedure Render; override;'                  +LineEnding+
 '    procedure Shutdown; override;'                +LineEnding+
 '  end;'                                           +LineEnding+LineEnding;
  Result:=Source;
end;

{ TPGFApplicationDescriptor }

constructor TPGFApplicationDescriptor.Create;
begin
  inherited Create;
  Name := 'PGF Game application';
end;

function TPGFApplicationDescriptor.GetLocalizedName: string;
begin
  Result := 'PGF Game Application';
end;

function TPGFApplicationDescriptor.GetLocalizedDescription: string;
begin
  Result := 'Delphi Application'+LineEnding+LineEnding
           +'A Delphi application compatible with Lazarus.'+LineEnding
           +'This files will be automatically maintained by Lazarus.';
end;

function TPGFApplicationDescriptor.InitProject(AProject: TLazProject
  ): TModalResult;
var
  NewSource: String;
  MainFile: TLazProjectFile;
begin
  Result:=inherited InitProject(AProject);

  MainFile:=AProject.CreateProjectFile('myGame.lpr');
  MainFile.IsPartOfProject:=true;
  AProject.AddFile(MainFile,false);
  AProject.MainFileID:=0;
  AProject.UseAppBundle:=true;
  AProject.LoadDefaultIcon;
  AProject.LazCompilerOptions.SyntaxMode:='Delphi';

   // create program source
  NewSource:='program myGame;'+LineEnding
    +LineEnding
    +'uses'+LineEnding
  //  +'  {$ifdef fpc}'+LineEnding
    +'sysutils // this includes the LCL widgetset'+LineEnding
//    +'  {$endif}'+LineEnding
    +'  { you can add units after this };'+LineEnding
    +LineEnding
    +'var Game: TGame;'+LineEnding
    +'begin'+LineEnding
    +'  Game:= TGame.Create;'+LineEnding
    +'  Game.Run;'+LineEnding
    +'  Game.Free;'+LineEnding
    +'end.'+LineEnding
    +LineEnding;
  AProject.MainFile.SetSourceText(NewSource,true);

  // add lcl pp/pas dirs to source search path
  AProject.AddPackageDependency('FCL');
  AProject.AddPackageDependency('pgf');
  AProject.LazCompilerOptions.UnitOutputDirectory:='lib'+PathDelim+'$(TargetCPU)-$(TargetOS)';
  AProject.LazCompilerOptions.TargetFilename:='Game';
end;

function TPGFApplicationDescriptor.CreateStartFiles(AProject: TLazProject): TModalResult;
begin
  Result:=LazarusIDE.DoNewEditorFile(FileDescriptorByName,'','',[nfIsPartOfProject,nfOpenInEditor,nfCreateDefaultSrc]);
end;

end.

